<!-- Overlay -->
<div *ngIf="visible" 
     class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fadeIn"
     (click)="cerrar()">
  
  <!-- Modal -->
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-hidden"
       (click)="$event.stopPropagation()">
    
    <!-- Header -->
    <div class="bg-gradient-to-r from-orange-500 to-amber-500 px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
            <lucide-icon name="rotate-ccw" [size]="20" class="text-white"></lucide-icon>
          </div>
          <div>
            <h2 class="text-lg font-bold text-white">Reabrir Tarea</h2>
            <p class="text-sm text-white/80 truncate max-w-[280px]">{{tareaTitulo}}</p>
          </div>
        </div>
        <button 
          class="p-2 hover:bg-white/20 rounded-lg transition-colors"
          (click)="cerrar()"
          [disabled]="isLoading">
          <lucide-icon name="x" [size]="20" class="text-white"></lucide-icon>
        </button>
      </div>
    </div>

    <!-- Content -->
    <div class="p-6 overflow-y-auto max-h-[calc(90vh-180px)]">
      <!-- Alerta informativa -->
      <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-5 flex items-start gap-3">
        <lucide-icon name="info" [size]="18" class="text-amber-600 mt-0.5 flex-shrink-0"></lucide-icon>
        <p class="text-sm text-amber-700">
          Al reabrir esta tarea, su estado cambiará a <strong>Pendiente</strong> y quedará registrado en el historial.
        </p>
      </div>

      <!-- Motivo de reapertura -->
      <div class="mb-5">
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          Motivo de reapertura <span class="text-red-500">*</span>
        </label>
        <p-select 
          [options]="motivosReapertura" 
          [(ngModel)]="motivoSeleccionado"
          optionLabel="label" 
          optionValue="value"
          placeholder="Selecciona un motivo"
          styleClass="w-full"
          appendTo="body"
          [disabled]="isLoading">
        </p-select>
      </div>

      <!-- Observaciones -->
      <div class="mb-5">
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          Observaciones <span class="text-red-500">*</span>
        </label>
        <textarea 
          pInputTextarea
          rows="3"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none"
          placeholder="Describe el motivo detallado de la reapertura (mínimo 10 caracteres)"
          [(ngModel)]="observaciones"
          [disabled]="isLoading"
          maxlength="500"></textarea>
        <p class="text-xs text-gray-500 mt-1 text-right">{{observaciones.length}}/500</p>
      </div>

      <!-- Campos opcionales -->
      <div class="border-t border-gray-200 pt-5">
        <p class="text-xs text-gray-500 uppercase font-medium mb-4">Campos opcionales</p>
        
        <div class="grid grid-cols-2 gap-4">
          <!-- Nueva prioridad -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Nueva prioridad
            </label>
            <p-select 
              [options]="prioridades" 
              [(ngModel)]="prioridadNueva"
              optionLabel="label" 
              optionValue="value"
              placeholder="Seleccionar"
              styleClass="w-full"
              appendTo="body"
              [overlayOptions]="{mode: 'overlay'}"
              [disabled]="isLoading">
            </p-select>
          </div>

          <!-- Nueva fecha de vencimiento -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Nueva fecha límite
            </label>
            <p-datepicker 
              [(ngModel)]="fechaVencimientoNueva"
              [minDate]="minDate"
              dateFormat="dd/mm/yy"
              [showIcon]="true"
              [iconDisplay]="'input'"
              [touchUI]="false"
              appendTo="body"
              styleClass="w-full"
              placeholder="Seleccionar"
              [disabled]="isLoading">
            </p-datepicker>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end gap-3">
      <button 
        class="px-5 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium"
        (click)="cerrar()"
        [disabled]="isLoading">
        Cancelar
      </button>
      <button 
        class="px-5 py-2.5 text-white bg-orange-600 rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
        [disabled]="!puedeConfirmar || isLoading"
        (click)="confirmar()">
        <lucide-icon *ngIf="isLoading" name="loader" [size]="16" class="animate-spin"></lucide-icon>
        <lucide-icon *ngIf="!isLoading" name="rotate-ccw" [size]="16"></lucide-icon>
        {{isLoading ? 'Reabriendo...' : 'Confirmar Reapertura'}}
      </button>
    </div>
  </div>
</div>
